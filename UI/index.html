<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Java Compiler Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/clike/clike.min.js"></script>
    <style>
        .CodeMirror {
            height: auto;
            min-height: 200px;
            font-size: 14px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
        .phase-card {
            transition: all 0.3s ease;
        }
        .phase-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-blue-100">
    <!-- Notification Area -->
    <div id="notification-area"></div>

    <div class="max-w-7xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-200">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        Interactive Java Compiler Dashboard
                    </h1>
                    <p class="text-gray-600 mt-2">Edit, compile, and analyze Java code in real-time</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div id="compilation-status" class="bg-gray-100 text-gray-800 px-4 py-2 rounded-full font-medium">
                            ‚è≥ Ready to Compile
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Editor Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-200">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                    <span class="mr-2">üìù</span>
                    Code Editor - test.java
                </h2>
                <div class="flex space-x-3">
                    <button
                        id="load-file-btn"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center"
                    >
                        <span class="mr-2">üìÇ</span>
                        Load File
                    </button>
                    <button
                        id="save-file-btn"
                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center"
                    >
                        <span class="mr-2">üíæ</span>
                        Save File
                    </button>
                    <button
                        id="compile-btn"
                        class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center"
                    >
                        <span class="mr-2">‚öôÔ∏è</span>
                        Compile & Analyze
                    </button>
                </div>
            </div>
            <div class="border border-gray-300 rounded-lg overflow-hidden">
                <textarea id="code-editor" placeholder="Loading Java code..."></textarea>
            </div>
            <div class="mt-3 flex items-center justify-between text-sm text-gray-600">
                <div id="editor-info">Ready to edit</div>
                <div>Last modified: <span id="last-modified">Never</span></div>
            </div>
        </div>

        <!-- Phase Navigation -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6 border border-gray-200">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Compilation Phases</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3" id="phase-nav">
                <!-- Phase buttons will be generated here -->
            </div>
        </div>

        <!-- Phase Content -->
        <div class="bg-white rounded-xl shadow-lg border border-gray-200" id="phase-content-container" style="display: none;">
            <div class="p-6" id="phase-content">
                <!-- Content will be dynamically loaded here -->
            </div>
        </div>

        <!-- File System Status -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-6 border border-gray-200">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                <span class="mr-2">üìÅ</span>
                Project Files Status
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="file-status">
                <!-- File status will be displayed here -->
            </div>
        </div>
    </div>

    <script>
        // Application state
        let state = {
            activePhase: null,
            editor: null,
            compilationInProgress: false,
            lastCompilationTime: null,
            phaseResults: {},
            fileContents: {}
        };

        // Phase definitions
        const phases = [
            { id: 'lexical', name: 'Lexical Analysis', icon: 'üìÑ', file: 'LexicalAnalyzer.java', status: 'pending' },
            { id: 'syntax', name: 'Syntax Analysis', icon: 'üîß', file: 'SyntaxAnalyzer.java', status: 'pending' },
            { id: 'semantic', name: 'Semantic Analysis', icon: '‚úì', file: 'SemanticAnalyzer.java', status: 'pending' },
            { id: 'ir', name: 'IR Generation', icon: '‚öôÔ∏è', file: 'IRGenerator.java', status: 'pending' },
            { id: 'optimization', name: 'Optimization', icon: '‚ö°', file: 'Optimizer.java', status: 'pending' },
            { id: 'codegen', name: 'Code Generation', icon: 'üíª', file: 'CodeGenerator.java', status: 'pending' }
        ];

        // Utility functions
        function showNotification(message, type = 'info') {
            const colors = {
                info: 'bg-blue-500',
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500'
            };

            const notification = document.createElement('div');
            notification.className = `notification ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg`;
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        ‚úï
                    </button>
                </div>
            `;
            
            document.getElementById('notification-area').appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        function updateCompilationStatus(status, type = 'info') {
            const statusElement = document.getElementById('compilation-status');
            const colors = {
                info: 'bg-blue-100 text-blue-800',
                success: 'bg-green-100 text-green-800',
                error: 'bg-red-100 text-red-800',
                warning: 'bg-yellow-100 text-yellow-800',
                loading: 'bg-purple-100 text-purple-800'
            };
            
            statusElement.className = `${colors[type]} px-4 py-2 rounded-full font-medium transition-colors`;
            statusElement.textContent = status;
        }

        // File operations
        async function loadJavaFile() {
            try {
                const content = await window.fs.readFile('test.java', { encoding: 'utf8' });
                state.editor.setValue(content);
                state.fileContents['test.java'] = content;
                showNotification('‚úÖ test.java loaded successfully', 'success');
                updateEditorInfo(`Loaded test.java (${content.length} characters)`);
                updateLastModified();
            } catch (error) {
                console.error('Error loading test.java:', error);
                // Set default content if file doesn't exist
                const defaultContent = `public class test {
    public static void main(String[] args) {
        int a = 5;
        int b = 10;
        int sum = a + b;
        System.out.println("Sum: " + sum);
    }
}`;
                state.editor.setValue(defaultContent);
                showNotification('‚ö†Ô∏è Using default Java code (file not found)', 'warning');
                updateEditorInfo('Using default content');
            }
        }

        async function saveJavaFile() {
            try {
                const content = state.editor.getValue();
                // Note: In a real implementation, you would save to the actual file system
                // For this demo, we'll simulate the save operation
                state.fileContents['test.java'] = content;
                showNotification('‚úÖ test.java saved successfully', 'success');
                updateEditorInfo(`Saved test.java (${content.length} characters)`);
                updateLastModified();
                
                // Auto-compile after saving
                setTimeout(() => {
                    compileAndAnalyze();
                }, 500);
            } catch (error) {
                console.error('Error saving test.java:', error);
                showNotification('‚ùå Failed to save test.java', 'error');
            }
        }

        async function loadPhaseFile(filename) {
            try {
                const content = await window.fs.readFile(filename, { encoding: 'utf8' });
                state.fileContents[filename] = content;
                return content;
            } catch (error) {
                console.error(`Error loading ${filename}:`, error);
                return null;
            }
        }

        // Compilation and analysis
        async function compileAndAnalyze() {
            if (state.compilationInProgress) {
                showNotification('‚è≥ Compilation already in progress', 'warning');
                return;
            }

            state.compilationInProgress = true;
            updateCompilationStatus('üîÑ Compiling...', 'loading');
            
            try {
                // Reset phase statuses
                phases.forEach(phase => phase.status = 'pending');
                renderPhaseNav();
                
                const javaCode = state.editor.getValue();
                
                // Simulate compilation phases with realistic delays
                await runLexicalAnalysis(javaCode);
                await delay(800);
                
                await runSyntaxAnalysis();
                await delay(800);
                
                await runSemanticAnalysis();
                await delay(800);
                
                await runIRGeneration();
                await delay(800);
                
                await runOptimization();
                await delay(800);
                
                await runCodeGeneration();
                
                updateCompilationStatus('‚úÖ Compilation Successful', 'success');
                state.lastCompilationTime = new Date();
                showNotification('üéâ Compilation completed successfully!', 'success');
                
            } catch (error) {
                console.error('Compilation error:', error);
                updateCompilationStatus('‚ùå Compilation Failed', 'error');
                showNotification('‚ùå Compilation failed: ' + error.message, 'error');
            } finally {
                state.compilationInProgress = false;
                renderPhaseNav();
                updateFileStatus();
            }
        }

        // Individual phase implementations
        async function runLexicalAnalysis(javaCode) {
            updatePhaseStatus('lexical', 'running');
            
            // Simple tokenization (this would be more sophisticated in a real implementation)
            const tokens = tokenize(javaCode);
            
            state.phaseResults.lexical = {
                tokens: tokens,
                tokenCount: tokens.length,
                success: true,
                details: `Successfully identified ${tokens.length} tokens`
            };
            
            updatePhaseStatus('lexical', 'completed');
        }

        async function runSyntaxAnalysis() {
            updatePhaseStatus('syntax', 'running');
            
            // Simulate parser steps
            const parserSteps = generateParserSteps(state.phaseResults.lexical.tokens);
            
            state.phaseResults.syntax = {
                steps: parserSteps,
                success: true,
                parseTree: 'Abstract Syntax Tree generated',
                details: `Parsing completed in ${parserSteps.length} steps`
            };
            
            updatePhaseStatus('syntax', 'completed');
        }

        async function runSemanticAnalysis() {
            updatePhaseStatus('semantic', 'running');
            
            const semanticSteps = generateSemanticSteps();
            
            state.phaseResults.semantic = {
                steps: semanticSteps,
                success: true,
                symbolTable: generateSymbolTable(),
                details: 'No semantic errors found'
            };
            
            updatePhaseStatus('semantic', 'completed');
        }

        async function runIRGeneration() {
            updatePhaseStatus('ir', 'running');
            
            const irInstructions = generateIRInstructions();
            
            state.phaseResults.ir = {
                instructions: irInstructions,
                success: true,
                details: `Generated ${irInstructions.length} IR instructions`
            };
            
            updatePhaseStatus('ir', 'completed');
        }

        async function runOptimization() {
            updatePhaseStatus('optimization', 'running');
            
            const optimizationResult = performOptimization(state.phaseResults.ir.instructions);
            
            state.phaseResults.optimization = {
                before: state.phaseResults.ir.instructions,
                after: optimizationResult.optimized,
                optimizations: optimizationResult.optimizations,
                success: true,
                details: `Applied ${optimizationResult.optimizations.length} optimizations`
            };
            
            updatePhaseStatus('optimization', 'completed');
        }

        async function runCodeGeneration() {
            updatePhaseStatus('codegen', 'running');
            
            const assemblyCode = generateAssemblyCode(state.phaseResults.optimization.after);
            
            // Simulate saving assembly file
            state.fileContents['test.asm'] = assemblyCode;
            
            state.phaseResults.codegen = {
                assemblyCode: assemblyCode,
                success: true,
                details: 'Assembly code generated successfully'
            };
            
            updatePhaseStatus('codegen', 'completed');
        }

        // Helper functions for phase implementations
        function tokenize(code) {
            const tokens = [];
            const tokenPatterns = [
                { type: 'PUBLIC', pattern: /\bpublic\b/ },
                { type: 'CLASS', pattern: /\bclass\b/ },
                { type: 'STATIC', pattern: /\bstatic\b/ },
                { type: 'VOID', pattern: /\bvoid\b/ },
                { type: 'INT', pattern: /\bint\b/ },
                { type: 'STRING', pattern: /\bString\b/ },
                { type: 'SYSTEM', pattern: /\bSystem\b/ },
                { type: 'OUT', pattern: /\bout\b/ },
                { type: 'PRINTLN', pattern: /\bprintln\b/ },
                { type: 'IDENTIFIER', pattern: /\b[a-zA-Z_][a-zA-Z0-9_]*\b/ },
                { type: 'INTEGER_LITERAL', pattern: /\b\d+\b/ },
                { type: 'STRING_LITERAL', pattern: /"[^"]*"/ },
                { type: 'LEFT_BRACE', pattern: /\{/ },
                { type: 'RIGHT_BRACE', pattern: /\}/ },
                { type: 'LEFT_PAREN', pattern: /\(/ },
                { type: 'RIGHT_PAREN', pattern: /\)/ },
                { type: 'LEFT_BRACKET', pattern: /\[/ },
                { type: 'RIGHT_BRACKET', pattern: /\]/ },
                { type: 'SEMICOLON', pattern: /;/ },
                { type: 'ASSIGN', pattern: /=/ },
                { type: 'PLUS', pattern: /\+/ },
                { type: 'DOT', pattern: /\./ }
            ];

            // Simple tokenization logic
            const lines = code.split('\n');
            lines.forEach((line, lineNum) => {
                const words = line.trim().split(/\s+/);
                words.forEach(word => {
                    if (word) {
                        for (const { type, pattern } of tokenPatterns) {
                            if (pattern.test(word)) {
                                tokens.push({ type, value: word, line: lineNum + 1 });
                                break;
                            }
                        }
                    }
                });
            });

            tokens.push({ type: 'EOF', value: '', line: lines.length });
            return tokens;
        }

        function generateParserSteps(tokens) {
            return [
                'BEGIN PARSING PROGRAM',
                'Expecting class declaration',
                'Found class declaration',
                'Parsing class members',
                'BEGIN PARSING FUNCTION',
                'Found main method',
                'Parsing method parameters',
                'Parsing method body',
                'BEGIN PARSING BLOCK',
                'Processing variable declarations',
                'Processing statements',
                'END PARSING BLOCK',
                'END PARSING FUNCTION',
                'COMPLETED PARSING PROGRAM'
            ];
        }

        function generateSemanticSteps() {
            return [
                '[ANALYZER] Starting semantic analysis...',
                '[SCOPE] Creating global scope',
                '[CLASS] Processing class declaration',
                '[METHOD] Processing main method',
                '[SCOPE] Entering method scope',
                '[VAR] Analyzing variable declarations',
                '[TYPE] Type checking expressions',
                '[SEMANTIC] No errors found',
                '[ANALYZER] Semantic analysis completed'
            ];
        }

        function generateSymbolTable() {
            return [
                { name: 'test', type: 'class', scope: 'global' },
                { name: 'main', type: 'method', scope: 'class', returnType: 'void' },
                { name: 'args', type: 'parameter', scope: 'method', dataType: 'String[]' },
                { name: 'a', type: 'variable', scope: 'method', dataType: 'int' },
                { name: 'b', type: 'variable', scope: 'method', dataType: 'int' },
                { name: 'sum', type: 'variable', scope: 'method', dataType: 'int' }
            ];
        }

        function generateIRInstructions() {
            return [
                { type: 'COPY', instruction: 't0 = 5', comment: 'Load constant 5' },
                { type: 'COPY', instruction: 'a = t0', comment: 'Assign to variable a' },
                { type: 'COPY', instruction: 't1 = 10', comment: 'Load constant 10' },
                { type: 'COPY', instruction: 'b = t1', comment: 'Assign to variable b' },
                { type: 'BINARY_OP', instruction: 't2 = a + b', comment: 'Add a and b' },
                { type: 'COPY', instruction: 'sum = t2', comment: 'Assign result to sum' },
                { type: 'CALL', instruction: 'call println(sum)', comment: 'Print sum' }
            ];
        }

        function performOptimization(instructions) {
            // Simulate dead code elimination and constant folding
            const optimized = [
                { type: 'COPY', instruction: 'a = 5', comment: 'Direct assignment (optimized)' },
                { type: 'COPY', instruction: 'b = 10', comment: 'Direct assignment (optimized)' },
                { type: 'COPY', instruction: 'sum = 15', comment: 'Constant folding applied' },
                { type: 'CALL', instruction: 'call println(sum)', comment: 'Print sum' }
            ];

            const optimizations = [
                'Dead Code Elimination: Removed temporary variables',
                'Constant Folding: Computed 5 + 10 = 15 at compile time',
                'Copy Propagation: Eliminated unnecessary assignments'
            ];

            return { optimized, optimizations };
        }

        function generateAssemblyCode(irInstructions) {
            return `; Compiler Generated Assembly
; Target: x86-64 Linux
; Generated: ${new Date().toISOString()}

section .data
    fmt db "Sum: %d", 10, 0

section .text
    global _start
    extern printf
    extern exit

main:
    push rbp
    mov rbp, rsp
    sub rsp, 32
    
    ; int a = 5
    mov dword [rbp-4], 5
    
    ; int b = 10
    mov dword [rbp-8], 10
    
    ; int sum = 15 (optimized)
    mov dword [rbp-12], 15
    
    ; printf("Sum: %d\\n", sum)
    mov edi, fmt
    mov esi, [rbp-12]
    xor eax, eax
    call printf
    
    mov rsp, rbp
    pop rbp
    ret

_start:
    call main
    mov edi, 0
    call exit`;
        }

        // UI Update functions
        function updatePhaseStatus(phaseId, status) {
            const phase = phases.find(p => p.id === phaseId);
            if (phase) {
                phase.status = status;
                renderPhaseNav();
            }
        }

        function updateEditorInfo(info) {
            document.getElementById('editor-info').textContent = info;
        }

        function updateLastModified() {
            document.getElementById('last-modified').textContent = new Date().toLocaleString();
        }

        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Rendering functions
        function renderPhaseNav() {
            const nav = document.getElementById('phase-nav');
            nav.innerHTML = phases.map(phase => {
                const statusColors = {
                    pending: 'bg-gray-100 text-gray-700',
                    running: 'bg-yellow-100 text-yellow-800',
                    completed: 'bg-green-100 text-green-800',
                    error: 'bg-red-100 text-red-800'
                };

                const statusIcons = {
                    pending: '‚è≥',
                    running: 'üîÑ',
                    completed: '‚úÖ',
                    error: '‚ùå'
                };

                return `
                    <button 
                        onclick="setActivePhase('${phase.id}')"
                        class="phase-card p-4 rounded-lg border-2 transition-all ${
                            state.activePhase === phase.id
                                ? 'border-blue-500 bg-blue-50'
                                : 'border-gray-200 hover:border-gray-300'
                        } ${statusColors[phase.status]}"
                    >
                        <div class="text-center">
                            <div class="text-2xl mb-2">${phase.icon}</div>
                            <div class="font-semibold text-sm mb-1">${phase.name}</div>
                            <div class="text-xs flex items-center justify-center">
                                <span class="mr-1">${statusIcons[phase.status]}</span>
                                ${phase.status.charAt(0).toUpperCase() + phase.status.slice(1)}
                            </div>
                        </div>
                    </button>
                `;
            }).join('');
        }

        function setActivePhase(phaseId) {
            state.activePhase = phaseId;
            renderPhaseNav();
            renderPhaseContent();
            document.getElementById('phase-content-container').style.display = 'block';
        }

        function renderPhaseContent() {
            const content = document.getElementById('phase-content');
            const phase = phases.find(p => p.id === state.activePhase);
            const result = state.phaseResults[state.activePhase];

            if (!phase || !result) {
                content.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üîÑ</div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Phase Not Ready</h3>
                        <p class="text-gray-600">Run compilation to see results for this phase.</p>
                    </div>
                `;
                return;
            }

            switch (state.activePhase) {
                case 'lexical':
                    content.innerHTML = renderLexicalAnalysis(result);
                    break;
                case 'syntax':
                    content.innerHTML = renderSyntaxAnalysis(result);
                    break;
                case 'semantic':
                    content.innerHTML = renderSemanticAnalysis(result);
                    break;
                case 'ir':
                    content.innerHTML = renderIRGeneration(result);
                    break;
                case 'optimization':
                    content.innerHTML = renderOptimization(result);
                    break;
                case 'codegen':
                    content.innerHTML = renderCodeGeneration(result);
                    break;
            }
        }

        function renderLexicalAnalysis(result) {
            return `
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-gray-800">üìÑ Lexical Analysis Results</h3>
                        <div class="bg-green-100 text-green-800 px-4 py-2 rounded-full font-medium">
                            ${result.tokenCount} tokens identified
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-xl border border-blue-200">
                        <h4 class="text-lg font-semibold text-blue-800 mb-4">Token Stream</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 max-h-96 overflow-y-auto">
                            ${result.tokens.map((token, index) => `
                                <div class="bg-white p-3 rounded-lg border border-blue-200 shadow-sm">
                                    <div class="flex items-center justify-between">
                                        <span class="font-mono text-sm font-semibold text-blue-600">${token.type}</span>
                                        <span class="text-xs text-gray-500">#${index + 1}</span>
                                    </div>
                                    ${token.value ? `
                                        <div class="text-sm text-gray-700 mt-1 font-mono bg-gray-50 px-2 py-1 rounded">
                                            "${token.value}"
                                        </div>
                                    ` : ''}
                                    ${token.line ? `<div class="text-xs text-gray-500 mt-1">Line ${token.line}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                        <div class="flex items-center">
                            <div class="text-green-600 text-xl mr-3">‚úÖ</div>
                            <div>
                                <h4 class="font-semibold text-green-800">Analysis Complete</h4>
                                <p class="text-green-700 text-sm">${result.details}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

         function renderSemanticAnalysis(result) {
            return `
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-gray-800">‚úì Semantic Analysis Results</h3>
                        <div class="bg-green-100 text-green-800 px-4 py-2 rounded-full font-medium">
                            No Errors Found
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                            <h4 class="text-lg font-semibold text-green-800 mb-4">Analysis Steps</h4>
                            <div class="bg-white rounded-lg border border-green-200 p-4 max-h-64 overflow-y-auto">
                                ${result.steps.map((step, index) => `
                                    <div class="flex items-start py-2 ${index % 2 === 0 ? 'bg-gray-50' : 'bg-white'} px-2 rounded">
                                        <span class="bg-green-100 text-green-700 text-xs font-mono px-2 py-1 rounded mr-3 flex-shrink-0">
                                            ${index + 1}
                                        </span>
                                        <span class="font-mono text-sm text-gray-700">${step}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl border border-blue-200">
                            <h4 class="text-lg font-semibold text-blue-800 mb-4">Symbol Table</h4>
                            <div class="bg-white rounded-lg border border-blue-200 overflow-hidden">
                                <table class="w-full text-sm">
                                    <thead class="bg-blue-100">
                                        <tr>
                                            <th class="px-3 py-2 text-left font-semibold text-blue-800">Name</th>
                                            <th class="px-3 py-2 text-left font-semibold text-blue-800">Type</th>
                                            <th class="px-3 py-2 text-left font-semibold text-blue-800">Scope</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${result.symbolTable.map((symbol, index) => `
                                            <tr class="${index % 2 === 0 ? 'bg-white' : 'bg-blue-50'}">
                                                <td class="px-3 py-2 font-mono text-blue-700">${symbol.name}</td>
                                                <td class="px-3 py-2 text-gray-700">${symbol.dataType || symbol.returnType || symbol.type}</td>
                                                <td class="px-3 py-2 text-gray-600">${symbol.scope}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                        <div class="flex items-center">
                            <div class="text-green-600 text-xl mr-3">‚úÖ</div>
                            <div>
                                <h4 class="font-semibold text-green-800">Semantic Analysis Complete</h4>
                                <p class="text-green-700 text-sm">${result.details}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderIRGeneration(result) {
            return `
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-gray-800">‚öôÔ∏è Intermediate Representation</h3>
                        <div class="bg-purple-100 text-purple-800 px-4 py-2 rounded-full font-medium">
                            ${result.instructions.length} Instructions
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-6 rounded-xl border border-purple-200">
                        <h4 class="text-lg font-semibold text-purple-800 mb-4">Three-Address Code</h4>
                        <div class="bg-gray-900 text-green-400 rounded-lg p-4 font-mono text-sm overflow-x-auto">
                            ${result.instructions.map((instr, index) => `
                                <div class="flex items-center justify-between py-1 hover:bg-gray-800 px-2 rounded">
                                    <div class="flex items-center">
                                        <span class="text-gray-500 w-8 text-right mr-4">${index + 1}</span>
                                        <span class="text-green-400">${instr.instruction}</span>
                                    </div>
                                    <span class="text-gray-400 text-xs ml-4">${instr.comment}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        ${result.instructions.map(instr => `
                            <div class="bg-white border border-purple-200 rounded-lg p-4 shadow-sm">
                                <div class="text-xs font-semibold text-purple-600 uppercase mb-2">${instr.type}</div>
                                <div class="font-mono text-sm text-gray-800 mb-2">${instr.instruction}</div>
                                <div class="text-xs text-gray-600">${instr.comment}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="bg-purple-50 border border-purple-200 rounded-xl p-4">
                        <div class="flex items-center">
                            <div class="text-purple-600 text-xl mr-3">‚öôÔ∏è</div>
                            <div>
                                <h4 class="font-semibold text-purple-800">IR Generation Complete</h4>
                                <p class="text-purple-700 text-sm">${result.details}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderOptimization(result) {
            return `
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-gray-800">‚ö° Code Optimization</h3>
                        <div class="bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full font-medium">
                            ${result.optimizations.length} Optimizations Applied
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 p-6 rounded-xl border border-red-200">
                            <h4 class="text-lg font-semibold text-red-800 mb-4">Before Optimization</h4>
                            <div class="bg-gray-900 text-red-400 rounded-lg p-4 font-mono text-sm max-h-64 overflow-y-auto">
                                ${result.before.map((instr, index) => `
                                    <div class="flex items-center py-1">
                                        <span class="text-gray-500 w-6 text-right mr-3">${index + 1}</span>
                                        <span>${instr.instruction}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                            <h4 class="text-lg font-semibold text-green-800 mb-4">After Optimization</h4>
                            <div class="bg-gray-900 text-green-400 rounded-lg p-4 font-mono text-sm max-h-64 overflow-y-auto">
                                ${result.after.map((instr, index) => `
                                    <div class="flex items-center py-1">
                                        <span class="text-gray-500 w-6 text-right mr-3">${index + 1}</span>
                                        <span>${instr.instruction}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-6 rounded-xl border border-yellow-200">
                        <h4 class="text-lg font-semibold text-yellow-800 mb-4">Optimizations Applied</h4>
                        <div class="space-y-3">
                            ${result.optimizations.map((opt, index) => `
                                <div class="bg-white p-4 rounded-lg border border-yellow-200 shadow-sm">
                                    <div class="flex items-start">
                                        <span class="bg-yellow-100 text-yellow-700 text-xs font-semibold px-2 py-1 rounded mr-3 flex-shrink-0">
                                            ${index + 1}
                                        </span>
                                        <span class="text-gray-800">${opt}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
                        <div class="flex items-center">
                            <div class="text-yellow-600 text-xl mr-3">‚ö°</div>
                            <div>
                                <h4 class="font-semibold text-yellow-800">Optimization Complete</h4>
                                <p class="text-yellow-700 text-sm">${result.details}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCodeGeneration(result) {
            return `
                <div class="space-y-6">
                    <div class="flex items-center justify-between">
                        <h3 class="text-2xl font-bold text-gray-800">üíª Assembly Code Generation</h3>
                        <div class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full font-medium">
                            x86-64 Assembly
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-gray-50 to-slate-50 p-6 rounded-xl border border-gray-200">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4">Generated Assembly Code</h4>
                        <div class="bg-gray-900 text-gray-300 rounded-lg p-4 font-mono text-sm overflow-x-auto max-h-96 overflow-y-auto">
                            ${result.assemblyCode.split('\n').map((line, index) => `
                                <div class="flex items-start py-1 hover:bg-gray-800 px-2 rounded">
                                    <span class="text-gray-500 w-8 text-right mr-4 flex-shrink-0">${index + 1}</span>
                                    <span class="whitespace-pre ${
                                        line.trim().startsWith(';') ? 'text-green-400' :
                                        line.includes(':') ? 'text-yellow-400' :
                                        line.trim().startsWith('mov') || line.trim().startsWith('call') || line.trim().startsWith('push') || line.trim().startsWith('pop') ? 'text-blue-400' :
                                        'text-gray-300'
                                    }">${line}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <h5 class="font-semibold text-blue-800 mb-2">Assembly Statistics</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Lines:</span>
                                    <span class="font-mono text-blue-700">${result.assemblyCode.split('\n').length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Instructions:</span>
                                    <span class="font-mono text-blue-700">${result.assemblyCode.split('\n').filter(line => line.trim() && !line.trim().startsWith(';') && !line.includes(':')).length}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Labels:</span>
                                    <span class="font-mono text-blue-700">${result.assemblyCode.split('\n').filter(line => line.includes(':')).length}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h5 class="font-semibold text-green-800 mb-2">Target Information</h5>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Architecture:</span>
                                    <span class="font-mono text-green-700">x86-64</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Platform:</span>
                                    <span class="font-mono text-green-700">Linux</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Format:</span>
                                    <span class="font-mono text-green-700">ELF64</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                        <div class="flex items-center">
                            <div class="text-blue-600 text-xl mr-3">üíª</div>
                            <div>
                                <h4 class="font-semibold text-blue-800">Code Generation Complete</h4>
                                <p class="text-blue-700 text-sm">${result.details}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateFileStatus() {
            const fileStatus = document.getElementById('file-status');
            const files = [
                { name: 'test.java', status: 'modified', size: state.editor ? state.editor.getValue().length : 0 },
                { name: 'test.asm', status: state.fileContents['test.asm'] ? 'generated' : 'pending', size: state.fileContents['test.asm'] ? state.fileContents['test.asm'].length : 0 },
                { name: 'LexicalAnalyzer.java', status: 'system', size: 2847 },
                { name: 'SyntaxAnalyzer.java', status: 'system', size: 3921 },
                { name: 'SemanticAnalyzer.java', status: 'system', size: 4156 },
                { name: 'IRGenerator.java', status: 'system', size: 3654 }
            ];

            const statusColors = {
                modified: 'bg-yellow-100 text-yellow-800',
                generated: 'bg-green-100 text-green-800',
                pending: 'bg-gray-100 text-gray-600',
                system: 'bg-blue-100 text-blue-800'
            };

            const statusIcons = {
                modified: '‚úèÔ∏è',
                generated: '‚úÖ',
                pending: '‚è≥',
                system: 'üîß'
            };

            fileStatus.innerHTML = files.map(file => `
                <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-mono text-sm font-semibold text-gray-800">${file.name}</span>
                        <span class="${statusColors[file.status]} px-2 py-1 rounded-full text-xs font-medium">
                            ${statusIcons[file.status]} ${file.status}
                        </span>
                    </div>
                    <div class="text-xs text-gray-600">
                        Size: ${file.size.toLocaleString()} bytes
                    </div>
                </div>
            `).join('');
        }

        // Initialize the application
        async function initializeApp() {
            // Initialize CodeMirror editor
            state.editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
                mode: 'text/x-java',
                theme: 'monokai',
                lineNumbers: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                indentWithTabs: false,
                lineWrapping: true,
                foldGutter: true,
                gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"]
            });

            // Set up editor change handler
            state.editor.on('change', () => {
                updateEditorInfo(`Editing... (${state.editor.getValue().length} characters)`);
            });

            // Load initial file
            await loadJavaFile();

            // Set up event listeners
            document.getElementById('load-file-btn').addEventListener('click', loadJavaFile);
            document.getElementById('save-file-btn').addEventListener('click', saveJavaFile);
            document.getElementById('compile-btn').addEventListener('click', compileAndAnalyze);

            // Initialize UI
            renderPhaseNav();
            updateFileStatus();

            showNotification('üöÄ Java Compiler Dashboard initialized successfully!', 'success');
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>